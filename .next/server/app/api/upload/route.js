"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3093:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>y,patchFetch:()=>_,requestAsyncStorage:()=>h,routeModule:()=>x,serverHooks:()=>v,staticGenerationAsyncStorage:()=>w});var r={};a.r(r),a.d(r,{POST:()=>f});var o=a(9303),n=a(8716),i=a(670),l=a(7070);let s=require("crypto");async function d(e){let t=await e.arrayBuffer(),a=Buffer.from(t),r=(0,s.createHash)("sha256").update(a).digest("hex");try{return{text:(await Object(function(){var e=Error("Cannot find module 'pdf-parse'");throw e.code="MODULE_NOT_FOUND",e}())(a)).text||"",metadata:{fileName:e.name,fileType:"application/pdf",size:e.size,hash:r,processedAt:new Date,extractionMethod:"primary"}}}catch{return{text:new TextDecoder("utf-8",{fatal:!1}).decode(a).replace(/[^\x20-\x7E\n\r]/g,"").trim()||`[PDF extraction failed for ${e.name}]`,metadata:{fileName:e.name,fileType:"application/pdf",size:e.size,hash:r,processedAt:new Date,extractionMethod:"fallback"}}}}async function c(e){let t=await e.arrayBuffer(),a=(0,s.createHash)("sha256").update(Buffer.from(t)).digest("hex");try{let r=await Object(function(){var e=Error("Cannot find module 'mammoth'");throw e.code="MODULE_NOT_FOUND",e}())({arrayBuffer:t});if(r.value?.trim())return{text:r.value,metadata:{fileName:e.name,fileType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",size:e.size,hash:a,processedAt:new Date,extractionMethod:"primary"}};throw Error("Empty mammoth extraction")}catch{let r=(await Promise.resolve().then(function(){var e=Error("Cannot find module 'jszip'");throw e.code="MODULE_NOT_FOUND",e})).default,o=await r.loadAsync(t),n=await o.file("word/document.xml")?.async("string");return{text:(n?n.replace(/<[^>]*>/g," ").replace(/&[^;]+;/g," ").replace(/\s+/g," ").trim():"")||`[DOCX fallback extraction for ${e.name}]`,metadata:{fileName:e.name,fileType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",size:e.size,hash:a,processedAt:new Date,extractionMethod:"fallback"}}}}async function p(e){let t=await e.text(),a=(0,s.createHash)("sha256").update(t).digest("hex");return{text:t,metadata:{fileName:e.name,fileType:"text/plain",size:e.size,hash:a,processedAt:new Date,extractionMethod:"primary"}}}async function m(e){let t=u(e);if(!t.valid)throw Error(t.error);let a=e.type;switch(["application/octet-stream",""].includes(a)&&(a=function(e){let t=e.toLowerCase().match(/\.([^.]+)$/);return t&&t[1]&&({pdf:"application/pdf",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",doc:"application/msword",txt:"text/plain",csv:"text/plain",json:"text/plain",xml:"text/plain",html:"text/plain",md:"text/plain"})[t[1]]||null}(e.name)||a),a){case"application/pdf":return d(e);case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return c(e);case"text/plain":return p(e);default:if(e.name.match(/\.(txt|csv|json|xml|html|md)$/i))return p(e);throw Error(`Unsupported file type: ${a} (original: ${e.type})`)}}function u(e){if(!e)return{valid:!1,error:"No file provided"};if(e.size>10485760)return{valid:!1,error:"File too large"};if(e.name.includes("../")||e.name.includes("..\\"))return{valid:!1,error:"Invalid file name"};let t=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","text/plain"].includes(e.type),a=["application/octet-stream",""].includes(e.type),r=e.name.match(/\.(txt|csv|json|xml|html|md|pdf|docx|doc)$/i);if(a){if(!r)return{valid:!1,error:"Invalid file type"}}else if(!t)return{valid:!1,error:"Invalid file type"};return{valid:!0}}async function f(e){try{let t=(await e.formData()).getAll("files");if(!t.length)return l.NextResponse.json({error:"No files uploaded"},{status:400});let a=Object(function(){var e=Error("Cannot find module '@supabase/supabase-js'");throw e.code="MODULE_NOT_FOUND",e}())("https://placeholder.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),r=[];for(let e of t){if(!u(e).valid)continue;let t=await m(e);await a.from("processed_documents").insert({file_name:t.metadata.fileName,file_type:t.metadata.fileType,file_size:t.metadata.size,file_hash:t.metadata.hash,extracted_text:t.text,extraction_method:t.metadata.extractionMethod,processed_at:t.metadata.processedAt}),r.push({fileName:e.name,textLength:t.text.length})}return l.NextResponse.json({success:!0,processed:r})}catch(e){return l.NextResponse.json({error:"Upload failed"},{status:500})}}(function(){var e=Error("Cannot find module 'pdf-parse'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module 'mammoth'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '@supabase/supabase-js'");throw e.code="MODULE_NOT_FOUND",e}();let x=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/home/runner/work/Foldera_Final_AI/Foldera_Final_AI/app/api/upload/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:w,serverHooks:v}=x,y="/api/upload/route";function _(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:w})}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,972],()=>a(3093));module.exports=r})();